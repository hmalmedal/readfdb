#' Read CSV file generated by FDB
#'
#' Read a CSV file generated by Ferjedatabanken.
#'
#' @param file Path to file
#'
#' @return A data frame.
#' @export
read_fdb_csv <- function(file) {
  checkmate::assertFile(file, access = "r")

  csv_lines <- readr::read_lines(file) %>%
    iconv("latin1", "utf8")

  csv_pages <- paginate(csv_lines)

  df <- lapply(csv_pages, parse_csv_page) %>%
    dplyr::bind_rows()

  checkmate::assertDataFrame(df, ncols = 15)

  if (df$subtype[1] == "D\u00f8gnvariasjon") {
    df <- parse_dognvariasjon(df)
  } else if (df$subtype[1] == "Ukesvariasjon") {
    df <- parse_ukesvariasjon(df)
  } else if (df$subtype[1] == "\u00c5rsvariasjon") {
    df <- parse_aarsvariasjon(df)
  } else {
    warning("Unimplemented file type. Returning unparsed data frame.")
  }

  df
}
